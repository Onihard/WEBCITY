{% extends "base.html" %}
{% block title %}DM: {{ target }}{% endblock %}
{% block content %}
  <div class="row justify-content-center">
    <div class="col-lg-7 col-md-9">
      <div class="card shadow-lg mt-4">
        <div class="card-body p-4">
          <div class="d-flex align-items-center gap-2 mb-3">
            <img src="https://www.gravatar.com/avatar/{{ target|gravatar_hash }}?d=identicon" class="rounded-circle border" style="width:40px;height:40px;" alt="avatar">
            <h3 class="mb-0">DM: {{ target }}</h3>
          </div>
          <div id="dm" class="border rounded-3 p-3 mb-3 bg-body-secondary shadow-sm" style="height: 340px; overflow-y: auto; transition: background 0.2s, color 0.2s;">
            {% for m in messages %}
              <div class="d-flex align-items-start gap-2 mb-2">
                <img src="https://www.gravatar.com/avatar/{{ m['sender_nick']|gravatar_hash }}?d=identicon" class="rounded-circle border" style="width:32px;height:32px;" alt="avatar">
                <div class="flex-grow-1">
                  <div class="d-flex align-items-center gap-2">
                    <strong>{{ m['sender_nick'] }}</strong>
                    <small class="text-muted">{{ m['timestamp'] }}</small>
                  </div>
                  <div class="dm-message-text">{{ m['message_text'] }}</div>
                </div>
              </div>
            {% else %}
              <div class="text-muted">Нет сообщений</div>
            {% endfor %}
          </div>
          <form action="{{ url_for('dm_send', target_nick=target) }}" method="post" class="d-flex gap-2">
            <input name="message" placeholder="Написать сообщение..." class="form-control" required maxlength="500">
            <button class="btn btn-primary"><i class="bi bi-send"></i></button>
          </form>
        </div>
      </div>
    </div>
  </div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<style>
  /* Тёмная/светлая тема для текста сообщений */
  html[data-bs-theme='dark'] .dm-message-text {
    color: #f8f9fa;
  }
  html[data-bs-theme='light'] .dm-message-text {
    color: #212529;
  }
</style>
<script>
// Автоскролл вниз при загрузке
window.addEventListener('DOMContentLoaded', function() {
  var dm = document.getElementById('dm');
  if (dm) dm.scrollTop = dm.scrollHeight;
});
</script>
{% endblock %}
